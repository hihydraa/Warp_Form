<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #111827;
      color: #f9fafb;
      margin: 0;
      padding: 16px;
      display: flex;
      justify-content: center;
    }
    .container {
      width: 100%;
      max-width: 480px;
      background: #1f2933;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    h1 {
      font-size: 1.3rem;
      margin-top: 0;
      margin-bottom: 12px;
      text-align: center;
    }
    label {
      display: block;
      margin-top: 12px;
      margin-bottom: 4px;
      font-weight: 600;
    }
    input[type="text"],
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #4b5563;
      background: #111827;
      color: #f9fafb;
      font-size: 0.95rem;
    }
    textarea {
      min-height: 80px;
      resize: vertical;
    }
    input[type="file"] {
      margin-top: 4px;
      color: #f9fafb;
    }
    .hint {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 2px;
    }
    button {
      width: 100%;
      margin-top: 16px;
      padding: 10px 16px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #ec4899, #f97316);
      color: white;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .status {
      margin-top: 12px;
      font-size: 0.9rem;
      text-align: center;
    }
    .status.error {
      color: #fca5a5;
    }
    .status.success {
      color: #6ee7b7;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h1>

    <form id="warp-form">
      <label for="ig">IG / ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
      <input type="text" id="ig" placeholder="@your_ig ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" required />

      <label for="message">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡∏ö‡∏ô‡∏à‡∏≠</label>
      <textarea id="message" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ß‡∏¢‡∏û‡∏£" required></textarea>

      <label for="warpImage">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡∏ö‡∏ô‡∏à‡∏≠</label>
      <input type="file" id="warpImage" accept="image/*" required />
      <div class="hint">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏£‡∏π‡∏õ (‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û)</div>

      <label for="slipImage">‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
      <input type="file" id="slipImage" accept="image/*" required />
      <div class="hint">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</div>

      <button type="submit">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </form>

    <div id="status" class="status"></div>
  </div>

  <script>
    // ======= 1) ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å =======
    // ‡πÉ‡∏™‡πà API key ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ ImgBB
    const IMGBB_API_KEY   = 'db23dbb367bb9291c84cb6d3d0208075';
    // ‡πÉ‡∏™‡πà URL Web App ‡∏à‡∏≤‡∏Å Apps Script (‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏ô Warp Screen)
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz8kRGfE7H9rISd3Pswb8NSlG-4DxHscs7uqFtaD9v65kdG_l18soDwveUu4sMmzok8KQ/exec';

    const formEl   = document.getElementById('warp-form');
    const statusEl = document.getElementById('status');

    async function uploadToImgbb(file, label) {
      if (!file) {
        throw new Error(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${label}`);
      }

      const fd = new FormData();
      fd.append('image', file);

      const url = `https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`;

      let res;
      try {
        res = await fetch(url, {
          method: 'POST',
          body: fd
        });
      } catch (e) {
        console.error('fetch to ImgBB failed:', e);
        throw new Error(`‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ImgBB ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (${label})`);
      }

      let json;
      try {
        json = await res.json();
      } catch (e) {
        console.error('cannot parse ImgBB response:', e);
        throw new Error(`‡∏≠‡πà‡∏≤‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å ImgBB ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (${label})`);
      }

      console.log('ImgBB response', label, json);

      if (!json.success) {
        const msg = (json.error && json.error.message)
          ? json.error.message
          : '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏õ ImgBB ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
        throw new Error(`${msg} (${label})`);
      }

      return json.data.url;
    }

    async function sendToAppsScript(payload) {
      // ‡∏™‡πà‡∏á JSON ‡πÄ‡∏Ç‡πâ‡∏≤ Apps Script
      try {
        const res = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        console.log('Apps Script status:', res.status);
      } catch (e) {
        console.error('fetch to Apps Script failed:', e);
        throw new Error('‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Google Apps Script ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');
      }
    }

    formEl.addEventListener('submit', async (e) => {
      e.preventDefault();

      const btn = formEl.querySelector('button[type="submit"]');
      btn.disabled = true;
      statusEl.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ...';
      statusEl.className = 'status';

      try {
        const ig       = document.getElementById('ig').value.trim();
        const message  = document.getElementById('message').value.trim();
        const warpFile = document.getElementById('warpImage').files[0];
        const slipFile = document.getElementById('slipImage').files[0];

        // 1) ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÑ‡∏õ ImgBB
        const warpImageUrl = await uploadToImgbb(warpFile, '‡∏£‡∏π‡∏õ‡∏ö‡∏ô‡∏à‡∏≠');
        const slipImageUrl = await uploadToImgbb(slipFile, '‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô');

        statusEl.textContent = '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';

        // 2) ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤ Apps Script ‚Üí Google Sheet
        const payload = { ig, message, warpImageUrl, slipImageUrl };
        await sendToAppsScript(payload);

        statusEl.textContent = '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏™‡∏ô‡∏∏‡∏Å üéâ';
        statusEl.className = 'status success';
        formEl.reset();
      } catch (err) {
        console.error(err);
        statusEl.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message;
        statusEl.className = 'status error';
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
